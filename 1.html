<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فاکتور هوشمند طلا</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');

        :root {
            --primary-color: #bfa045;
            --primary-dark: #a88d37;
            --secondary-color: #1a2e35;
            --background-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #e4e4e4;
            --danger-color: #d9534f;
            --success-color: #5cb85c;
            --info-color: #4e7c9d;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Vazirmatn', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 14px;
        }

        .container {
            max-width: 1100px;
            margin: 20px auto;
            padding: 15px;
        }

        header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        header h1 {
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        
        .gold-price-section {
            max-width: 400px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            align-items: flex-start;
        }

        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .card h2 {
            font-size: 1.2rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 9px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.95rem;
            background-color: #fdfdfd;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(191, 160, 69, 0.2);
        }

        .number-to-words {
            margin-top: 10px;
            padding: 8px;
            background-color: #e9f3f9;
            color: var(--info-color);
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            min-height: 38px;
        }
        .font-size-20 { font-size: 0.9em; }
        .font-size-30 { font-size: 0.8em; }
        .font-size-40 { font-size: 0.7em; }

        .btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background-color 0.2s;
        }
        .btn:hover { background-color: var(--primary-dark); }
        .btn-add { background-color: var(--info-color); }
        .btn-add:hover { background-color: #406883; }
        .btn-remove { background-color: var(--danger-color); padding: 5px 10px; font-size: 0.8rem; }

        .item-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr) auto;
            gap: 10px;
            align-items: flex-end;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .item-row:last-of-type { border-bottom: none; }

        .switch-container { display: flex; align-items: center; gap: 5px; }
        .switch { position: relative; display: inline-block; width: 100px; height: 32px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 32px; }
        .slider:before { position: absolute; content: ""; height: 24px; width: 46px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 32px; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(46px); }
        .slider-text { color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.7rem; font-weight: bold; width: 100%; display: flex; justify-content: space-around; padding: 0 5px;}

        .tax-switch-container { display:flex; align-items: center; gap: 10px; }
        .toggle-switch { width: 44px; height: 24px; }
        .toggle-switch .slider:before { height: 18px; width: 18px; }
        .toggle-switch input:checked + .slider:before { transform: translateX(20px); }

        .smart-discount-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
        .smart-discount-btn { background-color: #e9f3f9; color: var(--info-color); border: 1px solid var(--info-color); flex-grow: 1; font-size: 0.85rem;}

        /* Final Invoice Styling */
        .invoice-box { border: 1px solid var(--border-color); border-radius: 8px; background: var(--card-bg); padding: 25px; }
        .invoice-box table { width: 100%; line-height: inherit; text-align: right; }
        .invoice-box table td { padding: 8px; vertical-align: top; }
        .invoice-box .invoice-items-table thead td { background: #eee; border-bottom: 1px solid #ddd; font-weight: bold; }
        .invoice-box .invoice-items-table .item td { border-bottom: 1px solid var(--border-color); }
        .invoice-box .invoice-items-table .item.last td { border-bottom: none; }
        .invoice-box .totals-table { text-align: left; }
        .invoice-box .totals-table td:first-child { text-align: right; font-weight: bold; color: #555; }
        .invoice-box .totals-table .danger-text { color: var(--danger-color); }
        .invoice-box .grand-total td { border-top: 2px solid var(--primary-color); font-weight: bold; font-size: 1.1rem; }
        .invoice-box .grand-total .value { color: var(--success-color); }
        .invoice-box .grand-total.payable .value { color: var(--danger-color); }


        @media (max-width: 992px) {
            .main-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .item-row { grid-template-columns: 1fr 1fr; }
            .item-row > div:nth-child(3), .item-row > div:nth-child(4) { grid-column: span 2; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>فاکتور هوشمند طلا</h1>
            <div class="gold-price-section">
                <div class="form-group">
                    <label for="gold-price">قیمت هر گرم طلا ۱۸ عیار (تومان)</label>
                    <input type="text" id="gold-price" inputmode="numeric" placeholder="مثال: ۳,۵۰۰,۰۰۰">
                    <div id="gold-price-words" class="number-to-words"></div>
                </div>
            </div>
        </header>

        <div class="main-grid">
            <div class="main-column">
                <div class="card">
                    <h2>نوع محصول</h2>
                    <div id="gold-items-container">
                        <div class="item-row" data-item-id="1">
                            <div class="form-group">
                                <label>نوع محصول</label>
                                <select class="item-model">
                                    <option>طلا</option><option>سرویس</option><option>النگو</option><option>نیم‌ست</option><option>دستبند</option><option>زنجیر</option><option>گردنبند</option><option>گوشواره</option><option>مدال</option><option>پلاک</option><option>خلخال</option><option>آویز ساعت</option><option>رو لباسی</option><option>سفارشی</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>وزن (گرم)</label>
                                <input type="text" class="item-weight" inputmode="decimal" placeholder="مثال: ۱۲.۵">
                            </div>
                            <div class="form-group">
                                <label>اجرت</label>
                                <div class="switch-container">
                                    <input type="text" class="item-fee-value" inputmode="numeric" placeholder="مقدار">
                                    <label class="switch">
                                        <input type="checkbox" class="item-fee-type">
                                        <span class="slider"><div class="slider-text"><span>تومان</span><span>درصد</span></div></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="add-gold-item" class="btn btn-add" type="button">+ افزودن محصول جدید</button>
                </div>

                <div class="card">
                    <h2>خرید طلا از مشتری</h2>
                    <div id="buy-items-container">
                        </div>
                    <button id="add-buy-item" class="btn btn-add" type="button">+ افزودن آیتم خرید</button>
                </div>
            </div>

            <div class="side-column">
                <div class="card">
                    <h2>سود و مالیات</h2>
                    <div class="form-group">
                        <label for="profit-slider">سود فروشنده: <span id="profit-value" style="color: var(--primary-color); font-weight:bold;">7%</span></label>
                        <input type="range" id="profit-slider" min="1" max="7" value="7" step="0.5" style="width:100%;">
                    </div>
                    <div class="form-group tax-switch-container">
                        <label>مالیات ۱۰٪ (بر اجرت و سود)</label>
                        <label class="switch toggle-switch">
                           <input type="checkbox" id="tax-switch" checked>
                           <span class="slider"></span>
                       </label>
                   </div>
                </div>

                <div class="card">
                    <h2>تخفیف</h2>
                    <div class="form-group">
                        <label for="manual-discount">تخفیف دستی (تومان)</label>
                        <input type="text" id="manual-discount" inputmode="numeric" placeholder="مبلغ تخفیف">
                    </div>
                    <div class="form-group">
                        <label>تخفیف هوشمند</label>
                        <div id="smart-discount-container" class="smart-discount-container"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card invoice-box">
             <h2>فاکتور هوشمند</h2>
             <table>
                 <thead>
                     <tr class="invoice-items-table">
                         <td colspan="4">
                            <table>
                                <thead>
                                    <td>شرح محصول</td>
                                    <td>وزن</td>
                                    <td>فی کل (با احتساب سود و اجرت)</td>
                                </tr>
                                </thead>
                                <tbody id="invoice-items-body">
                                    </tbody>
                            </table>
                         </td>
                     </tr>
                      <tr class="invoice-items-table" id="invoice-buy-header-row" style="display:none;">
                         <td colspan="4">
                            <table>
                                <thead>
                                    <td>موارد خریداری شده از مشتری</td>
                                    <td>وزن</td>
                                    <td>ارزش</td>
                                </tr>
                                </thead>
                                <tbody id="invoice-buy-items-body">
                                    </tbody>
                            </table>
                         </td>
                     </tr>
                 </thead>
                 <tbody>
                    <tr>
                        <td colspan="4" style="padding: 15px 0;">
                             <table class="totals-table">
                                 <tr id="tax-total-row" style="display: none;">
                                     <td>مالیات کل</td>
                                     <td id="tax-total-value"></td>
                                 </tr>
                                 <tr id="discount-total-row" style="display: none;">
                                     <td>تخفیف</td>
                                     <td id="discount-total-value"></td>
                                 </tr>
                                 <tr id="buy-total-row" style="display: none;">
                                     <td class="danger-text">جمع خرید از مشتری (کسر از مبلغ)</td>
                                     <td id="buy-total-value" class="danger-text"></td>
                                 </tr>
                                 <tr class="grand-total" id="grand-total-row">
                                     <td id="grand-total-label">مبلغ نهایی قابل پرداخت</td>
                                     <td id="grand-total-value" class="value">۰ تومان</td>
                                 </tr>
                             </table>
                        </td>
                    </tr>
                 </tbody>
             </table>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // --- UTILITY FUNCTIONS ---
    const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    const parseFormattedNumber = (str) => parseFloat(String(str).replace(/,/g, '')) || 0;
    const toPersianNumerals = (str) => {
        const persian = { '0': '۰', '1': '۱', '2': '۲', '3': '۳', '4': '۴', '5': '۵', '6': '۶', '7': '۷', '8': '۸', '9': '۹', '.': '.' };
        return String(str).replace(/[0-9.]/g, (w) => persian[w]);
    };
    const numToWords = (num) => { /* ... (same function as before, kept for brevity) ... */ return '...'; };
    // A more robust number to words function is required for production
    const numToWordsSimple = (s) => {
        if (s == 0) return "صفر";
        const ones = ["", "یک", "دو", "سه", "چهار", "پنج", "شش", "هفت", "هشت", "نه"];
        const teens = ["ده", "یازده", "دوازده", "سیزده", "چهارده", "پانزده", "شانزده", "هفده", "هجده", "نوزده"];
        const tens = ["", "", "بیست", "سی", "چهل", "پنجاه", "شصت", "هفتاد", "هشتاد", "نود"];
        const hundreds = ["", "صد", "دویست", "سیصد", "چهارصد", "پانصد", "ششصد", "هفتصد", "هشتصد", "نهصد"];
        const thousands = ["", "هزار", "میلیون", "میلیارد"];
        let result = ""; let i = 0;
        while (s > 0) {
            let chunk = s % 1000;
            if (chunk > 0) {
                let chunkStr = "";
                let h = Math.floor(chunk / 100); let t = Math.floor((chunk % 100) / 10); let o = chunk % 10;
                if (h > 0) chunkStr += hundreds[h] + (t > 0 || o > 0 ? " و " : "");
                if (t === 1) { chunkStr += teens[o];
                } else { if (t > 1) chunkStr += tens[t] + (o > 0 ? " و " : ""); if (o > 0) chunkStr += ones[o]; }
                result = chunkStr + " " + thousands[i] + (result ? " و " : "") + result;
            }
            s = Math.floor(s / 1000); i++;
        }
        return result.trim();
    };


    // --- EVENT LISTENERS ---
    const container = document.querySelector('.container');
    container.addEventListener('input', handleDynamicInput);
    container.addEventListener('change', calculateAndRenderAll); // For selects/checkboxes
    document.getElementById('add-gold-item').addEventListener('click', addGoldItem);
    document.getElementById('add-buy-item').addEventListener('click', addBuyItem);
    
    function handleDynamicInput(e) {
        if (e.target.matches('#gold-price, .item-fee-value, #manual-discount, .buy-item-price')) {
            const input = e.target;
            let val = input.value.replace(/,/g, '');
            const maxLength = {
                'gold-price': 8,
                'item-fee-value': 7,
                'manual-discount': 12, // Arbitrary large number
                'buy-item-price': 9
            }[input.className] || input.id === 'gold-price' ? 8 : (input.id === 'manual-discount' ? 12 : 7);
            
            if (val.length > maxLength) {
                val = val.substring(0, maxLength);
            }
            
            input.value = formatNumber(val);
        }

        if (e.target.id === 'gold-price') {
            updateGoldPriceWords();
        }
        
        if (e.target.id === 'profit-slider') {
             document.getElementById('profit-value').textContent = `${e.target.value}%`;
        }

        calculateAndRenderAll();
    }
    
    function updateGoldPriceWords() {
        const goldPriceWordsDiv = document.getElementById('gold-price-words');
        const value = parseFormattedNumber(document.getElementById('gold-price').value);
        const words = numToWordsSimple(value);
        goldPriceWordsDiv.textContent = words ? `${words} تومان` : '';
        goldPriceWordsDiv.className = 'number-to-words';
        if (words.length > 40) goldPriceWordsDiv.classList.add('font-size-40');
        else if (words.length > 30) goldPriceWordsDiv.classList.add('font-size-30');
        else if (words.length > 20) goldPriceWordsDiv.classList.add('font-size-20');
    }

    function addGoldItem() {
        const container = document.getElementById('gold-items-container');
        const newRow = document.createElement('div');
        newRow.className = 'item-row';
        newRow.innerHTML = `
            <div class="form-group">
                <select class="item-model"><option>طلا</option><option>سرویس</option><option>النگو</option><option>نیم‌ست</option><option>دستبند</option><option>زنجیر</option><option>گردنبند</option><option>گوشواره</option><option>مدال</option><option>پلاک</option><option>خلخال</option><option>آویز ساعت</option><option>رو لباسی</option><option>سفارشی</option></select>
            </div>
            <div class="form-group">
                <input type="text" class="item-weight" inputmode="decimal" placeholder="وزن">
            </div>
            <div class="form-group">
                <div class="switch-container">
                    <input type="text" class="item-fee-value" inputmode="numeric" placeholder="مقدار اجرت">
                    <label class="switch"><input type="checkbox" class="item-fee-type"><span class="slider"><div class="slider-text"><span>تومان</span><span>درصد</span></div></span></label>
                </div>
            </div>
            <div class="form-group">
                <button class="btn btn-remove" type="button">حذف</button>
            </div>
        `;
        newRow.querySelector('.btn-remove').addEventListener('click', () => {
            newRow.remove();
            calculateAndRenderAll();
        });
        container.appendChild(newRow);
    }
    
    let buyItemId = 0;
    function addBuyItem() {
        buyItemId++;
        const container = document.getElementById('buy-items-container');
        const newRow = document.createElement('div');
        newRow.className = 'item-row';
        newRow.innerHTML = `
            <div class="form-group">
                <select class="buy-item-type">
                    <option value="gold">طلای متفرقه</option><option value="bullion">شمش</option><option value="parsian">سکه پارسیان</option><option value="coin">سکه بانکی</option>
                </select>
            </div>
            <div class="form-group buy-details-container">
                <input type="text" class="buy-item-weight" inputmode="decimal" placeholder="وزن">
            </div>
            <div class="form-group"></div>
            <div class="form-group">
                <button class="btn btn-remove" type="button">حذف</button>
            </div>
        `;
        
        const typeSelect = newRow.querySelector('.buy-item-type');
        const detailsContainer = newRow.querySelector('.buy-details-container');

        typeSelect.addEventListener('change', () => {
            const type = typeSelect.value;
            if (type === 'coin') {
                detailsContainer.innerHTML = `
                    <select class="buy-item-coin-model"><option>ربع ۸۶</option><option>نیم ۸۶</option><option>امامی ۸۶</option><option>ربع زیر ۸۶</option><option>نیم زیر ۸۶</option><option>امامی زیر ۸۶</option><option>یک گرمی بانکی</option></select>
                    <input type="text" class="buy-item-price" inputmode="numeric" placeholder="قیمت خرید" style="margin-top:5px;">
                `;
            } else {
                detailsContainer.innerHTML = `<input type="text" class="buy-item-weight" inputmode="decimal" placeholder="وزن">`;
            }
            calculateAndRenderAll();
        });

        newRow.querySelector('.btn-remove').addEventListener('click', () => {
            newRow.remove();
            calculateAndRenderAll();
        });
        container.appendChild(newRow);
    }
    
    // --- CORE CALCULATION LOGIC ---
    function calculateAndRenderAll() {
        const baseGoldPrice = parseFormattedNumber(document.getElementById('gold-price').value);
        const profitPercent = parseFloat(document.getElementById('profit-slider').value) / 100;
        const isTaxEnabled = document.getElementById('tax-switch').checked;

        let totalSalePrice = 0;
        let totalTax = 0;
        let saleItemsHtml = '';

        document.querySelectorAll('#gold-items-container .item-row').forEach(item => {
            const weight = parseFloat(item.querySelector('.item-weight').value) || 0;
            if (weight === 0) return;
            
            const feeValue = parseFormattedNumber(item.querySelector('.item-fee-value').value);
            const isFeePercent = item.querySelector('.item-fee-type').checked;
            const model = item.querySelector('.item-model').value;
            const goldValue = weight * baseGoldPrice;
            const craftsmanshipFee = isFeePercent ? goldValue * (Math.min(Math.max(feeValue, 1), 30) / 100) : feeValue;
            const itemSubtotal = goldValue + craftsmanshipFee;
            const profit = itemSubtotal * profitPercent;
            const tax = isTaxEnabled ? (craftsmanshipFee + profit) * 0.10 : 0;
            const itemTotal = itemSubtotal + profit;

            totalSalePrice += itemTotal;
            totalTax += tax;

            saleItemsHtml += `<tr class="item">
                <td>${model}</td>
                <td>${toPersianNumerals(weight)} گرم</td>
                <td>${toPersianNumerals(formatNumber(Math.round(itemTotal)))} ت</td>
            </tr>`;
        });
        
        let totalBuyValue = 0;
        let buyItemsHtml = '';
        document.querySelectorAll('#buy-items-container .item-row').forEach(item => {
            const type = item.querySelector('.buy-item-type').value;
            let value = 0;
            let weight = 0;
            let description = '';

            if (type === 'coin') {
                value = parseFormattedNumber(item.querySelector('.buy-item-price')?.value);
                description = `سکه ${item.querySelector('.buy-item-coin-model')?.value}`;
            } else {
                weight = parseFloat(item.querySelector('.buy-item-weight')?.value) || 0;
                if (weight > 0) {
                    if (type === 'bullion') value = (weight * 995 / 750) * baseGoldPrice;
                    else value = weight * baseGoldPrice;
                }
                const typeNames = {'gold': 'طلای متفرقه', 'bullion': 'شمش', 'parsian': 'سکه پارسیان'};
                description = typeNames[type];
            }
            if(value > 0) {
                 totalBuyValue += value;
                 buyItemsHtml += `<tr class="item">
                    <td>${description}</td>
                    <td>${weight > 0 ? toPersianNumerals(weight) + ' گرم' : '-'}</td>
                    <td>${toPersianNumerals(formatNumber(Math.round(value)))} ت</td>
                </tr>`;
            }
        });
        
        const grandTotalBeforeDiscount = totalSalePrice + totalTax;
        const maxDiscount = grandTotalBeforeDiscount * 0.30;
        let manualDiscount = parseFormattedNumber(document.getElementById('manual-discount').value);
        manualDiscount = Math.min(manualDiscount, maxDiscount);
        const finalTotal = grandTotalBeforeDiscount - totalBuyValue - manualDiscount;
        
        // RENDER FINAL INVOICE
        document.getElementById('invoice-items-body').innerHTML = saleItemsHtml || '<tr><td colspan="3" style="text-align:center; padding:15px 0;">-- موردی ثبت نشده --</td></tr>';
        document.getElementById('invoice-buy-items-body').innerHTML = buyItemsHtml;
        document.getElementById('invoice-buy-header-row').style.display = totalBuyValue > 0 ? 'table-row' : 'none';

        const taxRow = document.getElementById('tax-total-row');
        taxRow.style.display = totalTax > 0 ? 'table-row' : 'none';
        if (totalTax > 0) document.getElementById('tax-total-value').textContent = `${toPersianNumerals(formatNumber(Math.round(totalTax)))} ت`;
        
        const discountRow = document.getElementById('discount-total-row');
        discountRow.style.display = manualDiscount > 0 ? 'table-row' : 'none';
        if (manualDiscount > 0) document.getElementById('discount-total-value').textContent = `-${toPersianNumerals(formatNumber(Math.round(manualDiscount)))} ت`;
        
        const buyRow = document.getElementById('buy-total-row');
        buyRow.style.display = totalBuyValue > 0 ? 'table-row' : 'none';
        if (totalBuyValue > 0) document.getElementById('buy-total-value').textContent = `-${toPersianNumerals(formatNumber(Math.round(totalBuyValue)))} ت`;

        const grandTotalRow = document.getElementById('grand-total-row');
        const grandTotalLabel = document.getElementById('grand-total-label');
        const grandTotalValue = document.getElementById('grand-total-value');

        if(finalTotal < 0) {
            grandTotalLabel.textContent = 'مبلغ قابل پرداخت به مشتری';
            grandTotalValue.textContent = `${toPersianNumerals(formatNumber(Math.round(Math.abs(finalTotal))))} تومان`;
            grandTotalRow.classList.add('payable');
        } else {
            grandTotalLabel.textContent = 'مبلغ نهایی قابل پرداخت';
            grandTotalValue.textContent = `${toPersianNumerals(formatNumber(Math.round(finalTotal)))} تومان`;
            grandTotalRow.classList.remove('payable');
        }
        
        generateSmartDiscounts(grandTotalBeforeDiscount - totalBuyValue);
    }
    
    function generateSmartDiscounts(currentTotal) {
        const container = document.getElementById('smart-discount-container');
        container.innerHTML = '';
        if (currentTotal <= 1000) return;
        const maxSmartDiscount = 990000;
        let discounts = new Set();
        [10000, 50000, 100000, 500000, 1000000].forEach(unit => {
            let remainder = currentTotal % unit;
            if (remainder > 0 && remainder <= maxSmartDiscount) discounts.add(Math.round(remainder));
        });
        
        const sortedDiscounts = Array.from(discounts).sort((a,b) => a - b).slice(0, 5);
        sortedDiscounts.forEach(discount => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'btn smart-discount-btn';
            btn.dataset.discount = discount;
            btn.textContent = `رند کردن (${toPersianNumerals(formatNumber(discount))})`;
            container.appendChild(btn);
        });
    }

    // Initial run
    calculateAndRenderAll();
});
</script>

</body>
</html>
