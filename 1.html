<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محاسبه‌گر خرید طلا</title>
    <style>
        @font-face {
            font-family: 'Vazir';
            src: url('https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.woff') format('woff');
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazir', sans-serif;
            direction: rtl;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        .container {
            max-width: 100%;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .section h2 {
            font-size: 18px;
            color: #e74c3c;
            margin-bottom: 10px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-size: 14px;
            color: #34495e;
            margin-bottom: 5px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
            background: #fff;
            direction: ltr;
            text-align: right;
        }
        input[type="number"]::-webkit-inner-spin-button {
            opacity: 1;
        }
        .gold-price-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #goldPriceText {
            flex: 1;
            font-size: 16px;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: font-size 0.3s;
        }
        .small-font {
            font-size: 12px !important;
        }
        .add-item-btn, .calculate-btn, .smart-discount-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            margin-top: 10px;
            transition: background 0.3s;
        }
        .add-item-btn:hover, .calculate-btn:hover, .smart-discount-btn:hover {
            background: #219653;
        }
        .item-container {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: #fff;
        }
        .remove-item {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .tax-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        #invoice {
            margin-top: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 10px;
        }
        #invoice h2 {
            font-size: 18px;
            color: #2c3e50;
        }
        #invoice p {
            font-size: 14px;
            color: #333;
            margin: 5px 0;
        }
        .smart-discount-options {
            display: none;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .smart-discount-options button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
            min-width: 80px;
        }
        .smart-discount-options button:hover {
            background: #2980b9;
        }
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 20px;
            }
            .section h2 {
                font-size: 16px;
            }
            input, select {
                font-size: 14px;
            }
            .add-item-btn, .calculate-btn {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>محاسبه‌گر خرید طلا</h1>
        <div class="section">
            <h2>قیمت طلا</h2>
            <div class="input-group gold-price-container">
                <input type="text" id="goldPrice" maxlength="7" placeholder="قیمت طلا به تومان (۷ رقم)">
                <span id="goldPriceText"></span>
            </div>
        </div>
        <div class="section" id="goldItems">
            <h2>خرید طلا</h2>
            <div class="item-container" data-type="gold">
                <div class="input-group">
                    <label>وزن طلا (گرم)</label>
                    <input type="text" class="weight" placeholder="مثال: ۵.۲">
                </div>
                <div class="input-group">
                    <label>نوع طلا</label>
                    <select class="goldType">
                        <option value="سرویس">سرویس</option>
                        <option value="النگو">النگو</option>
                        <option value="نیم‌ست">نیم‌ست</option>
                        <option value="دستبند">دستبند</option>
                        <option value="زنجیر">زنجیر</option>
                        <option value="گردنبند">گردنبند</option>
                        <option value="گوشواره">گوشواره</option>
                        <option value="مدال">مدال</option>
                        <option value="پلاک">پلاک</option>
                        <option value="خلخال">خلخال</option>
                        <option value="آویز ساعت">آویز ساعت</option>
                        <option value="رو لباسی">رو لباسی</option>
                        <option value="سفارشی">سفارشی</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>اجرت</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="wage" placeholder="مقدار">
                        <select class="wageType">
                            <option value="percent">درصد (%)</option>
                            <option value="toman">تومان ($)</option>
                        </select>
                    </div>
                </div>
                <button class="remove-item" style="display: none;">حذف آیتم</button>
            </div>
            <button class="add-item-btn" onclick="addItem('gold')">اضافه کردن آیتم طلا</button>
        </div>
        <div class="section" id="parthianItems">
            <h2>خرید سکه پارسیان</h2>
            <div class="item-container" data-type="parthian">
                <div class="input-group">
                    <label>وزن (گرم)</label>
                    <input type="text" class="weight" placeholder="مثال: ۱.۵">
                </div>
                <button class="remove-item" style="display: none;">حذف آیتم</button>
            </div>
            <button class="add-item-btn" onclick="addItem('parthian')">اضافه کردن سکه پارسیان</button>
        </div>
        <div class="section" id="bullionItems">
            <h2>خرید شمش</h2>
            <div class="item-container" data-type="bullion">
                <div class="input-group">
                    <label>وزن (گرم)</label>
                    <input type="text" class="weight" placeholder="مثال: ۱۰.۰">
                </div>
                <button class="remove-item" style="display: none;">حذف آیتم</button>
            </div>
            <button class="add-item-btn" onclick="addItem('bullion')">اضافه کردن شمش</button>
        </div>
        <div class="section" id="coinItems">
            <h2>خرید سکه</h2>
            <div class="item-container" data-type="coin">
                <div class="input-group">
                    <label>نوع سکه</label>
                    <select class="coinType">
                        <option value="ربع ۸۶">ربع ۸۶</option>
                        <option value="نیم ۸۶">نیم ۸۶</option>
                        <option value="امامی ۸۶">امامی ۸۶</option>
                        <option value="ربع زیر ۸۶">ربع زیر ۸۶</option>
                        <option value="نیم زیر ۸۶">نیم زیر ۸۶</option>
                        <option value="امامی زیر ۸۶">امامی زیر ۸۶</option>
                        <option value="یک گرمی بانکی">یک گرمی بانکی</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>قیمت سکه (تومان)</label>
                    <input type="text" class="coinPrice" placeholder="قیمت به تومان">
                </div>
                <button class="remove-item" style="display: none;">حذف آیتم</button>
            </div>
            <button class="add-item-btn" onclick="addItem('coin')">اضافه کردن سکه</button>
        </div>
        <div class="section">
            <h2>تنظیمات</h2>
            <div class="input-group">
                <label>سود فروشنده (۱ تا ۷ درصد)</label>
                <input type="number" id="profit" min="1" max="7" value="7">
            </div>
            <div class="tax-toggle">
                <input type="checkbox" id="taxToggle" checked>
                <label for="taxToggle">محاسبه مالیات (۱۰ درصد)</label>
            </div>
            <div class="input-group">
                <label>تخفیف (تومان)</label>
                <input type="text" id="discount" placeholder="مقدار تخفیف">
            </div>
            <button class="smart-discount-btn" onclick="showSmartDiscounts()">تخفیف هوشمند</button>
            <div class="smart-discount-options" id="smartDiscountOptions"></div>
        </div>
        <button class="calculate-btn" onclick="calculate()">محاسبه فاکتور</button>
        <div id="invoice"></div>
    </div>
    <script>
        const persianNumbers = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
        const persianWords = [
            '', 'یک', 'دو', 'سه', 'چهار', 'پنج', 'شش', 'هفت', 'هشت', 'نه',
            'ده', 'یازده', 'دوازده', 'سیزده', 'چهارده', 'پانزده', 'شانزده', 'هفده', 'هجده', 'نوزده',
            'بیست', 'سی', 'چهل', 'پنجاه', 'شصت', 'هفتاد', 'هشتاد', 'نود',
            'صد', 'دویست', 'سیصد', 'چهارصد', 'پانصد', 'ششصد', 'هفتصد', 'هشتصد', 'نهصد',
            'هزار', 'میلیون', 'میلیارد'
        ];

        function toPersianNumber(num) {
            return num.toString().split('').map(n => persianNumbers[parseInt(n)]).join('');
        }

        function numberToWords(num) {
            if (num === 0) return 'صفر';
            let result = '';
            let billion = Math.floor(num / 1000000000);
            let million = Math.floor((num % 1000000000) / 1000000);
            let thousand = Math.floor((num % 1000000) / 1000);
            let remainder = num % 1000;

            if (billion) result += convertHundreds(billion) + ' میلیارد ';
            if (million) result += convertHundreds(million) + ' میلیون ';
            if (thousand) result += convertHundreds(thousand) + ' هزار ';
            if (remainder) result += convertHundreds(remainder);

            return result.trim();
        }

        function convertHundreds(num) {
            if (num === 0) return '';
            if (num < 20) return persianWords[num];
            if (num < 100) {
                let tens = Math.floor(num / 10) * 10;
                let ones = num % 10;
                return persianWords[tens / 10 + 18] + (ones ? ' و ' + persianWords[ones] : '');
            }
            let hundreds = Math.floor(num / 100);
            let rest = num % 100;
            return persianWords[hundreds + 27] + (rest ? ' و ' + convertHundreds(rest) : '');
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',').split('').map(n => n === ',' ? ',' : persianNumbers[parseInt(n)]).join('');
        }

        function addItem(type) {
            const container = document.getElementById(`${type}Items`);
            const template = container.querySelector('.item-container').outerHTML;
            const newItem = document.createElement('div');
            newItem.innerHTML = template;
            newItem.querySelector('.remove-item').style.display = 'block';
            newItem.querySelector('.remove-item').onclick = () => newItem.remove();
            container.insertBefore(newItem.firstChild, container.querySelector('.add-item-btn'));
        }

        function validateInput(value) {
            return value.match(/^\d*\.?\d*$/);
        }

        document.getElementById('goldPrice').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length > 7) {
                value = value.slice(0, 7);
            }
            e.target.value = value;
            let formatted = formatNumber(value);
            let words = numberToWords(parseInt(value) || 0) + ' تومان';
            let textElement = document.getElementById('goldPriceText');
            textElement.textContent = words;
            textElement.classList.toggle('small-font', words.length > 20);
        });

        function calculate() {
            let goldPrice = parseInt(document.getElementById('goldPrice').value) || 0;
            let profitPercent = parseInt(document.getElementById('profit').value) || 7;
            let includeTax = document.getElementById('taxToggle').checked;
            let manualDiscount = parseFloat(document.getElementById('discount').value.replace(/[^0-9.]/g, '')) || 0;

            let totalPrice = 0;
            let totalTax = 0;
            let invoiceDetails = [];

            // Gold Items
            document.querySelectorAll('#goldItems .item-container').forEach(item => {
                let weight = parseFloat(item.querySelector('.weight').value.replace(',', '.')) || 0;
                let goldType = item.querySelector('.goldType').value;
                let wage = parseFloat(item.querySelector('.wage').value.replace(',', '.')) || 0;
                let wageType = item.querySelector('.wageType').value;

                let basePrice = weight * goldPrice;
                let wageAmount = wageType === 'percent' ? (basePrice * wage / 100) : wage;
                let profit = basePrice * profitPercent / 100;
                let itemPrice = basePrice + wageAmount + profit;
                let tax = includeTax ? (wageAmount + profit) * 0.1 : 0;

                totalPrice += itemPrice;
                totalTax += tax;

                invoiceDetails.push(`طلا (${goldType}): ${formatNumber(Math.round(itemPrice))} تومان`);
            });

            // Parthian Coins
            document.querySelectorAll('#parthianItems .item-container').forEach(item => {
                let weight = parseFloat(item.querySelector('.weight').value.replace(',', '.')) || 0;
                let itemPrice = weight * goldPrice;

                totalPrice += itemPrice;

                invoiceDetails.push(`سکه پارسیان (${weight} گرم): ${formatNumber(Math.round(itemPrice))} تومان`);
            });

            // Bullion
            document.querySelectorAll('#bullionItems .item-container').forEach(item => {
                let weight = parseFloat(item.querySelector('.weight').value.replace(',', '.')) || 0;
                let itemPrice = (weight * 995 / 750) * goldPrice;

                totalPrice += itemPrice;

                invoiceDetails.push(`شمش (${weight} گرم): ${formatNumber(Math.round(itemPrice))} تومان`);
            });

            // Coins
            document.querySelectorAll('#coinItems .item-container').forEach(item => {
                let coinType = item.querySelector('.coinType').value;
                let coinPrice = parseFloat(item.querySelector('.coinPrice').value.replace(/[^0-9]/g, '')) || 0;

                totalPrice += coinPrice;

                invoiceDetails.push(`سکه (${coinType}): ${formatNumber(Math.round(coinPrice))} تومان`);
            });

            totalPrice += totalTax;
            totalPrice -= manualDiscount;

            let invoice = `<h2>فاکتور</h2>`;
            invoiceDetails.forEach(detail => invoice += `<p>${detail}</p>`);
            if (includeTax) invoice += `<p>مالیات: ${formatNumber(Math.round(totalTax))} تومان</p>`;
            if (manualDiscount) invoice += `<p>تخفیف: ${formatNumber(Math.round(manualDiscount))} تومان</p>`;
            invoice += `<p><strong>قیمت نهایی: ${formatNumber(Math.round(totalPrice))} تومان</strong></p>`;

            document.getElementById('invoice').innerHTML = invoice;
        }

        function showSmartDiscounts() {
            let totalPrice = 0;
            document.querySelectorAll('#goldItems .item-container').forEach(item => {
                let weight = parseFloat(item.querySelector('.weight').value.replace(',', '.')) || 0;
                let wage = parseFloat(item.querySelector('.wage').value.replace(',', '.')) || 0;
                let wageType = item.querySelector('.wageType').value;
                let basePrice = weight * (parseInt(document.getElementById('goldPrice').value) || 0);
                let wageAmount = wageType === 'percent' ? (basePrice * wage / 100) : wage;
                let profit = basePrice * (parseInt(document.getElementById('profit').value) || 7) / 100;
                totalPrice += basePrice + wageAmount + profit;
            });
            document.querySelectorAll('#parthianItems .item-container').forEach(item => {
                let weight = parseFloat(item.querySelector('.weight').value.replace(',', '.')) || 0;
                totalPrice += weight * (parseInt(document.getElementById('goldPrice').value) || 0);
            });
            document.querySelectorAll('#bullionItems .item-container').forEach(item => {
                let weight = parseFloat(item.querySelector('.weight').value.replace(',', '.')) || 0;
                totalPrice += (weight * 995 / 750) * (parseInt(document.getElementById('goldPrice').value) || 0);
            });
            document.querySelectorAll('#coinItems .item-container').forEach(item => {
                totalPrice += parseFloat(item.querySelector('.coinPrice').value.replace(/[^0-9]/g, '')) || 0;
            });
            if (document.getElementById('taxToggle').checked) {
                let taxBase = 0;
                document.querySelectorAll('#goldItems .item-container').forEach(item => {
                    let weight = parseFloat(item.querySelector('.weight').value.replace(',', '.')) || 0;
                    let wage = parseFloat(item.querySelector('.wage').value.replace(',', '.')) || 0;
                    let wageType = item.querySelector('.wageType').value;
                    let basePrice = weight * (parseInt(document.getElementById('goldPrice').value) || 0);
                    let wageAmount = wageType === 'percent' ? (basePrice * wage / 100) : wage;
                    let profit = basePrice * (parseInt(document.getElementById('profit').value) || 7) / 100;
                    taxBase += wageAmount + profit;
                });
                totalPrice += taxBase * 0.1;
            }

            let options = [];
            let rounded = Math.round(totalPrice);
            options.push(Math.floor(rounded / 1000) * 1000);
            options.push(Math.floor(rounded / 5000) * 5000);
            options.push(Math.floor(rounded / 10000) * 10000);
            options.push(Math.floor(rounded / 50000) * 50000);

            let discountOptions = document.getElementById('smartDiscountOptions');
            discountOptions.innerHTML = '';
            options.forEach(opt => {
                let btn = document.createElement('button');
                btn.textContent = formatNumber(opt);
                btn.onclick = () => {
                    document.getElementById('discount').value = formatNumber(Math.round(totalPrice - opt));
                    calculate();
                    discountOptions.style.display = 'none';
                };
                discountOptions.appendChild(btn);
            });
            discountOptions.style.display = 'flex';
        }

        // Input validation for weight and wage
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('weight') || e.target.classList.contains('wage') || e.target.id === 'discount') {
                let value = e.target.value.replace(',', '.');
                if (!validateInput(value)) {
                    e.target.value = value.slice(0, -1);
                } else {
                    e.target.value = value;
                }
            }
            if (e.target.classList.contains('coinPrice')) {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            }
        });
    </script>
</body>
</html>
